#!/bin/bash\nset -e  # Exit immediately if a command fails\n\n# Default parameters\nSERVER_IP=${1}\nSSH_USER=${2:-root}\nSSH_KEY_PATH=${3:-~/.ssh/flowdose-do}\nENVIRONMENT=${4:-staging}\nADMIN_EMAIL=${5} # Email used for Let's Encrypt registration\n\n# Validate parameters\nif [ -z \"$SERVER_IP\" ]; then\n  echo \"ERROR: Server IP address is required\"\n  exit 1\nfi\nif [ -z \"$ADMIN_EMAIL\" ]; then\n  echo \"ERROR: Admin email for Certbot is required\"\n  echo \"Usage: $0 <server_ip> [ssh_user] [ssh_key_path] [environment] <admin_email>\"\n  exit 1\nfi\n\necho \"===================================================\"\necho \"Applying SSL Configuration using Certbot\"\necho \"===================================================\"\necho \"Server IP: $SERVER_IP\"\necho \"SSH User: $SSH_USER\"\necho \"Environment: $ENVIRONMENT\"\necho \"Admin Email: $ADMIN_EMAIL\"\n\nAPI_DOMAIN=\"api-${ENVIRONMENT}.flowdose.xyz\"\nADMIN_DOMAIN=\"admin-${ENVIRONMENT}.flowdose.xyz\"\n\n# Command to execute on the remote server\nREMOTE_COMMAND=\"sudo certbot --nginx --reinstall -d ${API_DOMAIN} -d ${ADMIN_DOMAIN} --non-interactive --agree-tos -m ${ADMIN_EMAIL}\"\n\n# Execute commands on the remote server\necho \"Running Certbot to apply SSL configuration...\"\nssh -o StrictHostKeyChecking=no -i \"$SSH_KEY_PATH\" \"$SSH_USER@$SERVER_IP\" \"$REMOTE_COMMAND\"\n\n# Check the exit status of the SSH command\nif [ $? -eq 0 ]; then\n  echo -e \"\\nCertbot ran successfully. SSL should be configured.\"\nelse\n  echo -e \"\\nCertbot command failed. Check Certbot logs on the server.\"\n  exit 1\nfi\n\necho \"===================================================\"\necho \"SSL configuration step completed!\"\necho \"===================================================\" 